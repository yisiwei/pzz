<div class="container home-search-route">
  <div id="search" class="home-search-bg">
    <form class="form-horizontal home-search-local"  role="form">
      <div class="p10 form-group ml20">
        <div class="col-xs-offset-0 col-xs-12 module-change-city">
          <span class="crfff" id="currentCity"></span>
          <span> 
            <b class="crfff">[</b>
            <a id="slectcity" class="cr5b" href="javascript:void(0)">切换城市</a> 
            <b class="crfff">]</b>
          </span>
          <span class="crfff ml20">
            共有 <strong class="crred">1500</strong>
            条线路
          </span>
        </div>

      </div>
      <div class="form-group">
        <label for="originCar" class="col-xs-2 control-label crfff">上车地点</label>
        <div class="col-xs-4 startcity">

          <input class="form-control border-radius-style" id="startcity"  placeholder="出发城市">
        </div>
        <div class="col-xs-6">
          <input class="form-control border-radius-style" id="startPlace" placeholder="详细地址" />
          <span class="r10 cr3b offer-position-icon fa fa-map-marker fa-lg form-control-feedback"></span>
          <div id="searchStartPlace" class="offer-map-detail"></div>
        </div>
      </div>
      <div class="form-group">
        <label for="destinationCar" class="col-xs-2 control-label crfff">下车地点</label>
        <div class="col-xs-4 endcity">

          <input class="form-control border-radius-style" id="endcity" placeholder="目的城市" />
        </div>
        <div class="col-xs-6">
          <input class="form-control border-radius-style" id="endPlace" placeholder="详细地址" />
          <span class="cr3b r10 offer-position-icon fa fa-map-marker fa-lg form-control-feedback"></span>
          <div id="searchEndPlace" class="offer-map-detail"></div>
        </div>
      </div>
      <div class="form-group">
        <div class="col-xs-offset-2 col-xs-10">
          <button type="search" id="search-btn" class="btn btn-info text-btn border-radius-style">立即搜索</button>
          <button type="search" id="detail-search-btn" class="btn btn-info text-btn home-detail-search-btn">去详细搜索</button>
        </div>
      </div>
    </form>
  </div>
</div>

<script type="text/javascript">
  var labelFromcity = new Array();
  labelFromcity ['热门城市'] = new Array(0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40);
  labelFromcity ['A-F'] = new Array(0,3,4,5,6,28,29,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106);
  labelFromcity ['G-J'] = new Array(1,7,8,9,30,31,32,33,37,40,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146);
  labelFromcity ['K-N'] = new Array(10,11,12,34,35,38,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187);
  labelFromcity ['P-W'] = new Array(13,14,15,16,17,18,22,24,25,36,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251);
  labelFromcity ['X-Z'] = new Array(2,19,20,21,26,27,39,252,253,254,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,299,300,301,302,303,304,305,306,307,308,309,310,311,312,313,314);
  var hotList = new Array(14,15,16,17,18,19);

  
  //$(".tangram-suggestion-main").remove();
  

  $(document).ready(function(){
    $('#startcity').querycity({'data':citysFlight,'tabs':labelFromcity,'hotList':hotList},"startcity");
    $('#endcity').querycity({'data':citysFlight,'tabs':labelFromcity,'hotList':hotList},"endcity");

  });

  var startPlace;
  $(function(){
    var hasS = 0;
    var currentCity;
    function myFun(result){
      currentCity = result.name;
      //console.log("当前定位城市:"+currentCity);
      $("#startcity").val(currentCity.substr(0,2));
      $("#endcity").val(currentCity.substr(0,2));

      loadStartPlace();
      loadEndPlace();
    }
    var myCity = new BMap.LocalCity();
    myCity.get(myFun);

    function loadStartPlace(){//初始化起点地址

      startPlace = new BMap.Autocomplete({
        "input":"startPlace",
        "location":currentCity,
        onSearchComplete:function(r){
          var ps = [];
          for(var i = r.getNumPois()-1;i>-1;i--){
            var p = r.getPoi(i);
            //console.log("城市："+p.city);
            if(p.city == $("#startcity").val()+"市"){
              ps.push(p);
              $('.tangram-suggestion-main:eq(0) tr').eq(i).addClass('index' + i).find('td').attr('city', p.city).attr('district', p.district).attr('address', p.business);
            }else{
              $('.tangram-suggestion-main:eq(0) tr').eq(i).remove();
            }
          }
          if (!$('#startPlace').is(":focus")) {
              startPlace.hide();
          }
        }
      });
    }

    function loadEndPlace(){//初始化终点地址
      var endPlace = new BMap.Autocomplete({
        "input":"endPlace",
        "location":currentCity,
        onSearchComplete:function(r){
          var ps = [];
          for(var i = r.getNumPois()-1;i>-1;i--){
            var p = r.getPoi(i);
            //console.log("选择的城市："+$("#endcity").val()+"市");
            if(p.city == $("#endcity").val()+"市"){
              ps.push(p);
              $('.tangram-suggestion-main:eq(1) tr').eq(i).addClass('index' + i).find('td').attr('city', p.city).attr('district', p.district).attr('address', p.business);
            }else{
              $('.tangram-suggestion-main:eq(1) tr').eq(i).remove();
            }
          }
          if (!$('#endPlace').is(":focus")) {
              endPlace.hide();
          }
        }
      });
    }

    /*function startAutoCallback(r, i) {
      $('.tangram-suggestion-main:eq(0) tr td').removeClass('tangram-suggestion-current');
      if (i)
        $('.tangram-suggestion-main:eq(0) tr.index' + i + ' td').addClass('tangram-suggestion-current')
      else
        $('.tangram-suggestion-main:eq(0) tr:eq(0) td').addClass('tangram-suggestion-current')
    }*/
    

  });
</script>